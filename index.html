<html lang="it">

<head>
    <!-- Metadata -->
    <meta charset="utf-8">
    <meta name="keywords" content="cloudflare, pages, template, edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="robots" content="index, follow">
    <title>Che ore fa da Luca</title>
    <link rel="shortcut icon" type="image/png" href="favicon.png">
    <!-- Metadata END -->

    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="./css/bootstrap.min.css?1563">
    <link rel="stylesheet" type="text/css" href="style.css?2909">
    <link rel="stylesheet" type="text/css" href="./css/animate.min.css?7190">
    <link rel="stylesheet" type="text/css" href="./css/all.min.css">
    <!-- Stylesheets END -->

    <!-- Here HTMLRewriter will write the Metadata from _middleware.js -->
</head>

<body>

    <!-- Preloader -->
    <div id="page-loading-blocs-notifaction" class="page-preloader"></div>
    <!-- Preloader END -->


    <!-- Main container -->
    <div class="page-container">

        <!-- bloc-0 -->
        <div class="bloc bloc-fill-screen l-bloc " id="bloc-0">
            <div class="container">
                <div class="row">
                    <div class="col">
                        <h3 class="mg-md float-none text-center hero-subheader tc-black">
                            Da Luca sono le
                        </h3>
                        <h1 class="text-center mg-clear hero-header-text text-blue-gradient">
                            <span id="pacific-time">--:--:--</span>
                        </h1>
                        <h3 class="mg-md float-none text-center hero-subheader tc-black">
                            <span id="user-diff">Caricamento...</span>
                        </h3>
                        <div class="row" style="margin-top:1rem;">
                            <div class="col-12 col-md-6">
                                <div id="luca-tz-box" class="card text-center p-3 mb-2">
                                    <strong>Fuso di Luca</strong>
                                    <div id="luca-tz" style="margin-top:0.5rem;">Caricamento...</div>
                                </div>
                            </div>
                            <div class="col-12 col-md-6">
                                <div id="visitor-tz-box" class="card text-center p-3 mb-2">
                                    <strong>Il tuo fuso orario</strong>
                                    <div id="visitor-tz" style="margin-top:0.5rem;">Caricamento...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- bloc-0 END -->

        <!-- Additional JS -->
        <script src="./js/bootstrap.bundle.min.js?8537"></script>
        <script src="./js/blocs.min.js?4639"></script>
        <script src="./js/lazysizes.min.js" defer></script><!-- Additional JS END -->

        <!-- Script aggiunto: orologio Pacific Time + info fuso locale -->
        <script>
            (function () {
                const pacificEl = document.getElementById('pacific-time');
                const userTzEl = document.getElementById('user-diff');
                const lucaTzEl = document.getElementById('luca-tz');
                const visitorTzEl = document.getElementById('visitor-tz');

                function pad(n) { return String(n).padStart(2, '0'); }

                function formatOffset(mins) {
                    const sign = mins >= 0 ? '+' : '-';
                    const m = Math.round(Math.abs(mins));
                    const h = Math.floor(m / 60);
                    const mm = m % 60;
                    return `UTC${sign}${h}:${pad(mm)}`;
                }

                function update() {
                    const now = new Date();

                    // Ora Pacific (America/Los_Angeles) in formato 24h
                    const pacificTime = new Intl.DateTimeFormat('it-IT', {
                        timeZone: 'America/Los_Angeles',
                        hour: '2-digit', minute: '2-digit', second: '2-digit',
                        hour12: false
                    }).format(now);
                    pacificEl.textContent = pacificTime;

                    // Fuso orario visitatore
                    const visitorTz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Sconosciuto';
                    const userOffsetMin = -now.getTimezoneOffset(); // in minuti, positivo se avanti su UTC

                    // Calcolo offset Pacific in minuti usando formatToParts per ottenere componenti locali di PT
                    const parts = new Intl.DateTimeFormat('en-US', {
                        timeZone: 'America/Los_Angeles',
                        year: 'numeric', month: 'numeric', day: 'numeric',
                        hour: 'numeric', minute: 'numeric', second: 'numeric',
                        hour12: false
                    }).formatToParts(now);

                    const getPart = (type) => Number(parts.find(p => p.type === type).value);
                    const year = getPart('year'), month = getPart('month'), day = getPart('day');
                    const hour = getPart('hour'), minute = getPart('minute'), second = getPart('second');

                    const pacUtcMs = Date.UTC(year, month - 1, day, hour, minute, second);
                    const pacOffsetMin = (pacUtcMs - now.getTime()) / 60000; // negativo se PT è dietro UTC

                    // Differenza (visitator - Pacific) in minuti
                    const diffMin = Math.round(userOffsetMin - pacOffsetMin);
                    const diffSign = diffMin >= 0 ? 'avanti' : 'indietro';
                    const diffAbs = Math.abs(diffMin);
                    const diffH = Math.floor(diffAbs / 60);

                    // Popola elementi (testi in italiano)
                    userTzEl.textContent = `Sei ${diffH} ore ${diffSign} rispetto a Luca.`;
                    lucaTzEl.textContent = `America/Seattle — ${formatOffset(pacOffsetMin)}`;
                    visitorTzEl.textContent = `${visitorTz} — ${formatOffset(userOffsetMin)}`;
                }

                // Avvio aggiornamento ogni secondo
                update();
                setInterval(update, 1000);
            })();
        </script>

</body>

</html>